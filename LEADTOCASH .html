<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">import React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';</p>
<p class="p1">import {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>Zap, TrendingUp, Cpu, Users, Award, DollarSign, Lock,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>Send, Mic, Volume2, Maximize, CheckCircle, XCircle, Copy, RotateCcw, Home, Settings</p>
<p class="p1">} from 'lucide-react';</p>
<p class="p2"><br></p>
<p class="p1">// --- CONFIGURACIÓN E IMPORTACIONES DE FIREBASE ---</p>
<p class="p1">import { initializeApp } from 'firebase/app';</p>
<p class="p1">import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'firebase/auth';</p>
<p class="p1">import {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>getFirestore, doc, setDoc, getDoc,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>collection, addDoc,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>serverTimestamp<span class="Apple-converted-space"> </span></p>
<p class="p1">} from 'firebase/firestore';</p>
<p class="p2"><br></p>
<p class="p1">// --- CONSTANTES GLOBALES Y CONFIGURACIÓN ---</p>
<p class="p1">const LEAD_ORANGE = '#B73F00';</p>
<p class="p1">const LEAD_GRAY = '#3B3B3B';</p>
<p class="p1">const LEAD_WHITE = '#F6F4F0';</p>
<p class="p2"><br></p>
<p class="p1">const VIEWS = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>LANDING: '/',</p>
<p class="p1"><span class="Apple-converted-space">    </span>PRO_GATE: '/pro',</p>
<p class="p1"><span class="Apple-converted-space">    </span>PRO_SETUP: '/pro/setup',</p>
<p class="p1"><span class="Apple-converted-space">    </span>PRO_TRAIN: '/pro/train',</p>
<p class="p1"><span class="Apple-converted-space">    </span>PRO_SUMMARY: '/pro/summary',</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// Variables globales proporcionadas por el entorno de Canvas</p>
<p class="p1">const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');</p>
<p class="p1">const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;</p>
<p class="p1">const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';</p>
<p class="p1">const GEMINI_MODEL = "gemini-2.5-flash-preview-05-20";</p>
<p class="p1">const API_KEY = ""; // Dejado vacío para que Canvas lo inyecte</p>
<p class="p2"><br></p>
<p class="p1">let app, db, auth;</p>
<p class="p2"><br></p>
<p class="p1">// Esquema de JSON forzado para la respuesta de Feedback (Gemini API)</p>
<p class="p1">const FEEDBACK_SCHEMA = {</p>
<p class="p1"><span class="Apple-converted-space">  </span>type: "OBJECT",</p>
<p class="p1"><span class="Apple-converted-space">  </span>properties: {</p>
<p class="p1"><span class="Apple-converted-space">    </span>score: {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>type: "INTEGER",</p>
<p class="p1"><span class="Apple-converted-space">      </span>description: "Puntuación total de 0 a 10."<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>aciertos: {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>type: "ARRAY",</p>
<p class="p1"><span class="Apple-converted-space">      </span>description: "Una lista de 3 aciertos/puntos fuertes del pitch.",</p>
<p class="p1"><span class="Apple-converted-space">      </span>items: { type: "STRING" }</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>mejoras: {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>type: "ARRAY",</p>
<p class="p1"><span class="Apple-converted-space">      </span>description: "Una lista de 3 áreas de mejora o errores cometidos.",</p>
<p class="p1"><span class="Apple-converted-space">      </span>items: { type: "STRING" }</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>guion: {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>type: "STRING",</p>
<p class="p1"><span class="Apple-converted-space">      </span>description: "Guion de cierre mejorado y conciso (máximo 130 palabras) basado en el contexto de la conversación. Debe empezar con la etiqueta: **(Guion Mejorado)**."<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p1"><span class="Apple-converted-space">  </span>required: ["score", "aciertos", "mejoras", "guion"]</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// --- UTILITY PARA LA API DE GEMINI CON EXPONENTIAL BACKOFF ---</p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* Llama a la API de Gemini con reintentos y backoff exponencial.</p>
<p class="p1"><span class="Apple-converted-space"> </span>* @param {object} payload - El cuerpo de la solicitud (contents, systemInstruction, etc.).</p>
<p class="p1"><span class="Apple-converted-space"> </span>* @param {object} generationConfig - Configuración de generación (opcional, para JSON).</p>
<p class="p1"><span class="Apple-converted-space"> </span>* @returns {Promise&lt;string|object&gt;} - El texto generado o el objeto JSON si se usa un esquema.</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const callGeminiApi = async (payload, generationConfig = {}) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const fullPayload = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>...payload,</p>
<p class="p1"><span class="Apple-converted-space">    </span>config: { ...payload.config, ...generationConfig }</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const MAX_RETRIES = 5;</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; MAX_RETRIES; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const response = await fetch(apiUrl, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">        </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">        </span>body: JSON.stringify(fullPayload)</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!response.ok) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Si no es un error de rate limit (429), lanzamos el error inmediatamente</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (response.status !== 429) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>throw new Error(`API call failed with status ${response.status}: ${await response.text()}`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Si es 429, continuamos al bloque catch para reintentar</p>
<p class="p1"><span class="Apple-converted-space">        </span>throw new Error("Rate limit exceeded (429). Retrying.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const result = await response.json();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const part = result?.candidates?.[0]?.content?.parts?.[0];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (part?.text) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (generationConfig.responseMimeType === "application/json") {</p>
<p class="p1"><span class="Apple-converted-space">          </span>// Si se solicitó JSON, intentar parsear el texto</p>
<p class="p1"><span class="Apple-converted-space">          </span>try {</p>
<p class="p1"><span class="Apple-converted-space">            </span>return JSON.parse(part.text);</p>
<p class="p1"><span class="Apple-converted-space">          </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>console.error("Error al parsear el JSON de la API:", e);</p>
<p class="p1"><span class="Apple-converted-space">            </span>throw new Error("Respuesta JSON mal formada de la API.");</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>return part.text;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>throw new Error("No se encontró contenido generado en la respuesta de la API.");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.warn(`Intento ${i + 1} fallido: ${error.message}.`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (i === MAX_RETRIES - 1) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>throw new Error("Fallo en la llamada a la API después de varios reintentos.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Backoff exponencial: 1s, 2s, 4s, 8s, 16s</p>
<p class="p1"><span class="Apple-converted-space">      </span>const delay = Math.pow(2, i) * 1000;</p>
<p class="p1"><span class="Apple-converted-space">      </span>await new Promise(resolve =&gt; setTimeout(resolve, delay));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// --- COMPONENTES DE UI GENÉRICOS ---</p>
<p class="p2"><br></p>
<p class="p1">const PrimaryButton = ({ children, onClick, href, type = 'button', className = '', disabled = false }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const commonClasses = `px-6 py-3 font-extrabold text-sm md:text-base tracking-widest uppercase transition-all duration-300 transform shadow-lg rounded-xl focus:outline-none focus:ring-4 focus:ring-opacity-50 active:scale-[0.98] ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const orangeClasses = `bg-[${LEAD_ORANGE}] text-white hover:bg-opacity-90 ring-[${LEAD_ORANGE}] focus:ring-[${LEAD_ORANGE}]`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if (href) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return (</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;a</p>
<p class="p1"><span class="Apple-converted-space">        </span>href={href}</p>
<p class="p1"><span class="Apple-converted-space">        </span>className={`${commonClasses} ${orangeClasses} text-center inline-flex justify-center items-center`}</p>
<p class="p1"><span class="Apple-converted-space">        </span>target="_blank"</p>
<p class="p1"><span class="Apple-converted-space">        </span>rel="noopener noreferrer"</p>
<p class="p1"><span class="Apple-converted-space">        </span>onClick={onClick}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">      </span>onClick={onClick}</p>
<p class="p1"><span class="Apple-converted-space">      </span>type={type}</p>
<p class="p1"><span class="Apple-converted-space">      </span>className={`${commonClasses} ${orangeClasses}`}</p>
<p class="p1"><span class="Apple-converted-space">      </span>disabled={disabled}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">const SecondaryButton = ({ children, onClick, href, className = '', disabled = false }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const commonClasses = `px-6 py-3 font-bold text-sm md:text-base tracking-wide uppercase transition-all duration-300 transform rounded-xl border-2 border-[${LEAD_GRAY}] hover:border-[${LEAD_ORANGE}] focus:outline-none active:scale-[0.98] ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if (href) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return (</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;a</p>
<p class="p1"><span class="Apple-converted-space">        </span>href={href}</p>
<p class="p1"><span class="Apple-converted-space">        </span>className={`${commonClasses} text-center inline-flex justify-center items-center text-[${LEAD_WHITE}] hover:text-[${LEAD_ORANGE}]`}</p>
<p class="p1"><span class="Apple-converted-space">        </span>target="_blank"</p>
<p class="p1"><span class="Apple-converted-space">        </span>rel="noopener noreferrer"</p>
<p class="p1"><span class="Apple-converted-space">        </span>disabled={disabled}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">      </span>onClick={onClick}</p>
<p class="p1"><span class="Apple-converted-space">      </span>className={`${commonClasses} text-[${LEAD_WHITE}] hover:text-[${LEAD_ORANGE}]`}</p>
<p class="p1"><span class="Apple-converted-space">      </span>disabled={disabled}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>{children}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">const NavBar = ({ currentView, setView, isProUser, hasAvatar }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return (</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;nav className="fixed top-0 left-0 right-0 z-40 bg-black/90 backdrop-blur-sm shadow-lg border-b border-gray-800"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className="container mx-auto px-4 py-3 flex justify-between items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>className="flex items-center cursor-pointer"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>onClick={() =&gt; setView(VIEWS.LANDING)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;Zap size={24} className={`text-[${LEAD_ORANGE}] mr-2`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span className="text-xl font-extrabold tracking-tight text-white"&gt;Lead to Cash&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="space-x-4 flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{currentView !== VIEWS.LANDING &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;SecondaryButton onClick={() =&gt; setView(VIEWS.LANDING)} className="p-2 border-0 hover:border-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;Home size={20} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{isProUser &amp;&amp; currentView !== VIEWS.PRO_SETUP &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;SecondaryButton onClick={() =&gt; setView(VIEWS.PRO_SETUP)} className="p-2 border-0 hover:border-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;Settings size={20} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{!isProUser &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;PrimaryButton<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>onClick={() =&gt; setView(VIEWS.PRO_GATE)}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>className="text-xs py-2 px-4"</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;DollarSign size={16} className="mr-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>Actualizar a PRO</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>{isProUser &amp;&amp; currentView !== VIEWS.PRO_TRAIN &amp;&amp; hasAvatar &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;PrimaryButton<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>onClick={() =&gt; setView(VIEWS.PRO_TRAIN)}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>className="text-xs py-2 px-4"</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;Cpu size={16} className="mr-1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>Entrenar</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/nav&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// --- PÁGINAS DE LA APLICACIÓN PRO ---</p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* 1. Control de Acceso: Pantalla Bloqueada</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const ProAccessGate = ({ onUpgradeClick }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div className="flex flex-col items-center justify-center min-h-screen pt-16 text-center p-6 bg-black"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;Lock size={64} className={`text-[${LEAD_ORANGE}] mb-6 animate-pulse`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h2 className="text-4xl font-extrabold mb-4 text-white"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>Esto es solo para closers reales.</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p className="text-xl text-gray-400 mb-8 max-w-lg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>Actualiza a **Lead to Cash Pro** y desbloquea el entrenamiento ilimitado y personalizado con IA.</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;PrimaryButton<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Link simulado a Stripe Checkout</p>
<p class="p1"><span class="Apple-converted-space">      </span>href="https://buy.stripe.com/..."<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>className="animate-bounce"</p>
<p class="p1"><span class="Apple-converted-space">    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;DollarSign size={20} className="mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>Actualizar a Pro</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;SecondaryButton onClick={onUpgradeClick} className="mt-4 border-gray-700"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>Volver a la Landing</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* 2. Formulario de Configuración del Avatar</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const AvatarSetupForm = ({ userId, db, onAvatarSet, defaultData }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [formData, setFormData] = useState(defaultData || {</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>businessType: '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>ticket: 500,</p>
<p class="p1"><span class="Apple-converted-space">    </span>frequentObjections: [],</p>
<p class="p1"><span class="Apple-converted-space">    </span>mainPain: '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>mainDream: '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>language: 'Español'</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isLoading, setIsLoading] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [message, setMessage] = useState('');</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Limpiar el estado de carga al cambiar la vista</p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setIsLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessage('');</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [defaultData]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const objectionOptions = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>'Precio', 'Tiempo', 'Autoridad', 'Confianza', 'Competencia', 'No es prioridad'</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p1"><span class="Apple-converted-space">  </span>const businessOptions = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>'Estética', 'Consultoría', 'SaaS', 'Gimnasio', 'Inmobiliaria', 'Finanzas', 'Otro'</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleChange = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const { name, value } = e.target;</p>
<p class="p1"><span class="Apple-converted-space">    </span>setFormData(prev =&gt; ({ ...prev, [name]: value }));</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleObjectionToggle = (objection) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setFormData(prev =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const current = prev.frequentObjections;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (current.includes(objection)) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>return { ...prev, frequentObjections: current.filter(o =&gt; o !== objection) };</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Límite de 4 objeciones</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (current.length &gt;= 4) return prev;</p>
<p class="p1"><span class="Apple-converted-space">        </span>return { ...prev, frequentObjections: [...current, objection] };</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleSubmit = async (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!db || !userId) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setMessage("Error de autenticación. Intenta recargar.");</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Validación de campos obligatorios</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!formData.name || !formData.businessType || !formData.mainPain || !formData.mainDream || formData.frequentObjections.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessage("Por favor, completa todos los campos requeridos y selecciona al menos una objeción.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>setIsLoading(true);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setMessage('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Guardar en /artifacts/{appId}/users/{userId}/avatars/{userId}</p>
<p class="p1"><span class="Apple-converted-space">      </span>const avatarRef = doc(db, `artifacts/${appId}/users/${userId}/avatars/${userId}`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>await setDoc(avatarRef, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>...formData,</p>
<p class="p1"><span class="Apple-converted-space">        </span>userId: userId,</p>
<p class="p1"><span class="Apple-converted-space">        </span>ticket: Number(formData.ticket), // Asegurar que es un número</p>
<p class="p1"><span class="Apple-converted-space">        </span>createdAt: serverTimestamp(),</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.log("Avatar guardado con éxito.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>onAvatarSet(formData); // Mover a la vista de entrenamiento</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.error("Error al guardar el avatar:", error);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessage("Error al guardar el avatar. Consulta la consola.");</p>
<p class="p1"><span class="Apple-converted-space">    </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setIsLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className={`container mx-auto px-4 py-24 text-[${LEAD_WHITE}] max-w-2xl`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2 className="text-3xl font-extrabold mb-2"&gt;Configura tu Avatar PRO&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p className={`mb-8 text-gray-400 border-l-4 border-[${LEAD_ORANGE}] pl-3 font-semibold`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>**Menos historia, más cierres.** Tu coach IA aprenderá de ti.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;form onSubmit={handleSubmit} className="space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>label="Nombre del Vendedor"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>name="name"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>value={formData.name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>placeholder="Ej: Max Cash"</p>
<p class="p1"><span class="Apple-converted-space">          </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Select<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>label="Tipo de Negocio"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>name="businessType"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>value={formData.businessType}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>options={businessOptions}</p>
<p class="p1"><span class="Apple-converted-space">          </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>label="Ticket promedio (€)"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>name="ticket"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>type="number"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>value={formData.ticket}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>min="10"</p>
<p class="p1"><span class="Apple-converted-space">          </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Select<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>label="Idioma del Entrenamiento"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>name="language"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>value={formData.language}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>options={['Español', 'Inglés']}</p>
<p class="p1"><span class="Apple-converted-space">          </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;Textarea<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>label="Dolor principal del cliente"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>name="mainPain"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>value={formData.mainPain}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>placeholder="Ej: Pierde €2k al mes por procesos lentos."</p>
<p class="p1"><span class="Apple-converted-space">        </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;Textarea<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>label="Sueño o meta del cliente"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>name="mainDream"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>value={formData.mainDream}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>onChange={handleChange}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>placeholder="Ej: Alcanzar 10k€/mes de ingresos pasivos."</p>
<p class="p1"><span class="Apple-converted-space">        </span>/&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label className="block text-sm font-medium mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Objeción más frecuente (Multi-select, máx. 4)</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="flex flex-wrap gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{objectionOptions.map(obj =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">                </span>key={obj}</p>
<p class="p1"><span class="Apple-converted-space">                </span>type="button"</p>
<p class="p1"><span class="Apple-converted-space">                </span>onClick={() =&gt; handleObjectionToggle(obj)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>className={`px-4 py-2 text-xs font-semibold rounded-full transition-colors ${</p>
<p class="p1"><span class="Apple-converted-space">                  </span>formData.frequentObjections.includes(obj)<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>? `bg-[${LEAD_ORANGE}] text-white shadow-md`</p>
<p class="p1"><span class="Apple-converted-space">                    </span>: 'bg-black/50 text-gray-300 border border-gray-600 hover:bg-black'</p>
<p class="p1"><span class="Apple-converted-space">                </span>}`}</p>
<p class="p1"><span class="Apple-converted-space">              </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{obj}</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>))}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>{message &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p className="text-red-500 text-sm text-center font-semibold"&gt;{message}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;PrimaryButton type="submit" className="w-full mt-8" disabled={isLoading}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>{isLoading ? 'Guardando Avatar...' : 'Entrenar mi avatar'}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/form&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">// Helper components for the form</p>
<p class="p1">const Input = ({ label, name, type = 'text', value, onChange, min, ...props }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label htmlFor={name} className="block text-sm font-medium mb-1"&gt;{label}&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>type={type}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>id={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>name={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>value={value}</p>
<p class="p1"><span class="Apple-converted-space">      </span>onChange={onChange}</p>
<p class="p1"><span class="Apple-converted-space">      </span>min={min}</p>
<p class="p1"><span class="Apple-converted-space">      </span>className={`w-full p-3 rounded-xl bg-black border border-gray-700 focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}]`}</p>
<p class="p1"><span class="Apple-converted-space">      </span>required</p>
<p class="p1"><span class="Apple-converted-space">      </span>{...props}</p>
<p class="p1"><span class="Apple-converted-space">    </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">const Select = ({ label, name, value, onChange, options }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label htmlFor={name} className="block text-sm font-medium mb-1"&gt;{label}&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;select<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>id={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>name={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>value={value}</p>
<p class="p1"><span class="Apple-converted-space">      </span>onChange={onChange}</p>
<p class="p1"><span class="Apple-converted-space">      </span>className={`w-full p-3 rounded-xl bg-black border border-gray-700 focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}]`}</p>
<p class="p1"><span class="Apple-converted-space">      </span>required</p>
<p class="p1"><span class="Apple-converted-space">    </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value="" disabled&gt;Selecciona una opción&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>{options.map(opt =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;option key={opt} value={opt}&gt;{opt}&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>))}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">const Textarea = ({ label, name, value, onChange, placeholder }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label htmlFor={name} className="block text-sm font-medium mb-1"&gt;{label}&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;textarea<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>id={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>name={name}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>value={value}</p>
<p class="p1"><span class="Apple-converted-space">      </span>onChange={onChange}</p>
<p class="p1"><span class="Apple-converted-space">      </span>rows="2"</p>
<p class="p1"><span class="Apple-converted-space">      </span>className={`w-full p-3 rounded-xl bg-black border border-gray-700 focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}] resize-none`}</p>
<p class="p1"><span class="Apple-converted-space">      </span>required</p>
<p class="p1"><span class="Apple-converted-space">      </span>placeholder={placeholder}</p>
<p class="p1"><span class="Apple-converted-space">    </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* 3. Chat + Voz (Entrenamiento)</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const TrainingSession = ({ userId, db, avatarData, onSessionEnd }) =&gt; {</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const CLIENT_ROLE_SYSTEM_PROMPT = useMemo(() =&gt; `</p>
<p class="p1"><span class="Apple-converted-space">    </span>Eres un cliente real, escéptico y con el perfil definido a continuación. Tu objetivo es poner a prueba al vendedor y no ceder fácilmente.</p>
<p class="p1"><span class="Apple-converted-space">    </span>**Cliente Avatar:**</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Vendedor que te atiende: ${avatarData.name}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Tu industria: ${avatarData.businessType}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Ticket que te piden: €${avatarData.ticket}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Tu principal dolor: ${avatarData.mainPain}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Tu sueño o meta: ${avatarData.mainDream}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Objeciones que debes usar para resistirte (usa una o varias en cada respuesta): ${avatarData.frequentObjections.join(', ')}</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Idioma de la conversación: ${avatarData.language}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>Tu primera respuesta ya se ha dado (iniciada por el sistema). Ahora debes responder al último mensaje del vendedor. Manten la conversación natural y coherente. No te auto-evalúes. Solo actúa como cliente. Si el vendedor te pide feedback, NO lo des, solo responde con otra objeción o escepticismo, pero registra la petición.</p>
<p class="p1"><span class="Apple-converted-space">  </span>`, [avatarData]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const COACH_EVAL_SYSTEM_PROMPT = `</p>
<p class="p1"><span class="Apple-converted-space">    </span>Eres el "Lead to Cash PRO Coach", un entrenador de ventas de alto rendimiento. Tu tarea es evaluar el rol-play completo (transcripción) que te proporcionaré.</p>
<p class="p1"><span class="Apple-converted-space">    </span>Debes devolver tu análisis en formato JSON estricto, siguiendo el esquema proporcionado.</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>**Criterios de Evaluación:**</p>
<p class="p1"><span class="Apple-converted-space">    </span>1.<span class="Apple-converted-space">  </span>Diagnóstico (Sondeo y comprensión del dolor): 0–3</p>
<p class="p1"><span class="Apple-converted-space">    </span>2.<span class="Apple-converted-space">  </span>Valor/ROI (Conexión de la solución con el sueño del cliente): 0–3</p>
<p class="p1"><span class="Apple-converted-space">    </span>3.<span class="Apple-converted-space">  </span>Manejo de objeción (Habilidad para neutralizar la resistencia): 0–3</p>
<p class="p1"><span class="Apple-converted-space">    </span>4.<span class="Apple-converted-space">  </span>Claridad/Confianza (Tono, autoridad y uso de lenguaje de cierre): 0–1</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>El score final es la suma de las puntuaciones (máx. 10).</p>
<p class="p1"><span class="Apple-converted-space">    </span>Proporciona 3 aciertos, 3 mejoras y un guion mejorado para un cierre exitoso, limitado a 130 palabras.</p>
<p class="p1"><span class="Apple-converted-space">    </span>La respuesta y el guion deben estar en ${avatarData.language}.</p>
<p class="p1"><span class="Apple-converted-space">  </span>`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const initialClientResponse = `Hola ${avatarData.name}, tengo 5 minutos. Estoy aquí porque me preocupa **${avatarData.mainPain}**. ¿Qué tienes para mí? (Objeción principal para empezar: **${avatarData.frequentObjections[0]}**)`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const initialMessage = { role: 'bot', text: initialClientResponse };</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const [messages, setMessages] = useState([]);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [input, setInput] = useState('');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isBotThinking, setIsBotThinking] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isVoiceActive, setIsVoiceActive] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [error, setError] = useState(null);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const messagesEndRef = useRef(null);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Reiniciar el chat al montar o al cambiar de avatar</p>
<p class="p1"><span class="Apple-converted-space">    </span>setMessages([initialMessage]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setError(null);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [avatarData]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Auto-scroll a la parte inferior del chat</p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [messages]);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Llama a la API de Gemini para obtener la respuesta del cliente simulado</p>
<p class="p1"><span class="Apple-converted-space">  </span>const getClientResponse = useCallback(async (currentInput) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const historyParts = messages.slice(1).map(m =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">        </span>role: m.role === 'user' ? 'user' : 'model',</p>
<p class="p1"><span class="Apple-converted-space">        </span>parts: [{ text: m.text }]</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Agregar el mensaje actual del usuario</p>
<p class="p1"><span class="Apple-converted-space">    </span>historyParts.push({ role: 'user', parts: [{ text: currentInput }] });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const payload = {</p>
<p class="p1"><span class="Apple-converted-space">      </span>contents: historyParts,</p>
<p class="p1"><span class="Apple-converted-space">      </span>systemInstruction: { parts: [{ text: CLIENT_ROLE_SYSTEM_PROMPT }] }</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const responseText = await callGeminiApi(payload);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessages(prev =&gt; [...prev, { role: 'bot', text: responseText }]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.error("Error al obtener la respuesta del cliente:", e);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setError("❌ Error de comunicación con la IA (Cliente). Intenta de nuevo.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessages(prev =&gt; [...prev, { role: 'bot', text: `ERROR: No pude responder. El cliente (IA) ha fallado. Reintenta tu último mensaje. (${e.message})` }]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [messages, CLIENT_ROLE_SYSTEM_PROMPT]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Llama a la API de Gemini para obtener el feedback estructurado</p>
<p class="p1"><span class="Apple-converted-space">  </span>const getFeedbackResponse = useCallback(async (history) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const historyParts = history.slice(1).map(m =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">        </span>role: m.role === 'user' ? 'user' : 'model',</p>
<p class="p1"><span class="Apple-converted-space">        </span>parts: [{ text: m.text }]</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const payload = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>contents: historyParts,</p>
<p class="p1"><span class="Apple-converted-space">        </span>systemInstruction: { parts: [{ text: COACH_EVAL_SYSTEM_PROMPT }] },</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const generationConfig = {</p>
<p class="p1"><span class="Apple-converted-space">      </span>responseMimeType: "application/json",</p>
<p class="p1"><span class="Apple-converted-space">      </span>responseSchema: FEEDBACK_SCHEMA,</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const feedbackJson = await callGeminiApi(payload, generationConfig);</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Aseguramos que los arrays y el score sean válidos antes de continuar</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (feedbackJson.score === undefined || !Array.isArray(feedbackJson.aciertos) || !Array.isArray(feedbackJson.mejoras)) {</p>
<p class="p1"><span class="Apple-converted-space">         </span>throw new Error("Estructura de feedback de la IA incompleta o inválida.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Guardar sesión y feedback en Firestore</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (db &amp;&amp; userId) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sessionData = {</p>
<p class="p1"><span class="Apple-converted-space">          </span>userId: userId,</p>
<p class="p1"><span class="Apple-converted-space">          </span>avatar: avatarData,</p>
<p class="p1"><span class="Apple-converted-space">          </span>transcript: history.map(m =&gt; ({role: m.role, text: m.text})),</p>
<p class="p1"><span class="Apple-converted-space">          </span>timestamp: serverTimestamp(),</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sessionRef = await addDoc(collection(db, `artifacts/${appId}/users/${userId}/sessions`), sessionData);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>await setDoc(doc(db, `artifacts/${appId}/users/${userId}/feedback`, sessionRef.id), {</p>
<p class="p1"><span class="Apple-converted-space">           </span>...feedbackJson,</p>
<p class="p1"><span class="Apple-converted-space">           </span>sessionId: sessionRef.id,</p>
<p class="p1"><span class="Apple-converted-space">           </span>timestamp: serverTimestamp(),</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.log("Sesión y feedback guardados con éxito.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Mover a la vista de resumen</p>
<p class="p1"><span class="Apple-converted-space">      </span>onSessionEnd(feedbackJson);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.error("Error al generar el feedback (JSON o API):", e);</p>
<p class="p1"><span class="Apple-converted-space">      </span>setError("❌ Error fatal al generar el feedback. La IA no pudo analizar la sesión. Revisa la consola.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>setMessages(prev =&gt; [...prev, { role: 'bot', text: `ERROR FATAL: La IA no pudo generar el feedback estructurado. No se pudo obtener Score/Guion. (${e.message})` }]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [COACH_EVAL_SYSTEM_PROMPT, db, userId, avatarData, onSessionEnd]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleSendMessage = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!input.trim() || isBotThinking) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>setError(null);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const messageToSend = input.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const history = [...messages, { role: 'user', text: messageToSend }];</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>setMessages(history);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setInput('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>setIsBotThinking(true);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Decidir si pedir feedback o continuar el roleplay</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (messageToSend.toLowerCase().includes('feedback')) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>getFeedbackResponse(history).finally(() =&gt; setIsBotThinking(false));</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>getClientResponse(messageToSend).finally(() =&gt; setIsBotThinking(false));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const toggleVoice = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// SIMULACIÓN: Esto iniciaría la grabación y TTS en una aplicación real</p>
<p class="p1"><span class="Apple-converted-space">    </span>setIsVoiceActive(prev =&gt; !prev);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isVoiceActive) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setError("🎙️ Simulación de voz activa. Escribe tu transcripción en el input y pulsa enviar.");</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setError(null);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const ChatMessage = ({ msg }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className={`max-w-xs md:max-w-lg p-4 rounded-xl shadow-xl ${</p>
<p class="p1"><span class="Apple-converted-space">        </span>msg.role === 'user'<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>? `bg-[${LEAD_ORANGE}]/80 text-white rounded-br-none`<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>: `bg-[${LEAD_GRAY}] text-gray-200 rounded-tl-none border border-gray-700`</p>
<p class="p1"><span class="Apple-converted-space">      </span>} transition-all duration-300`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className={`font-semibold mb-1 text-xs uppercase opacity-70 ${msg.role === 'bot' ? `text-[${LEAD_ORANGE}]` : 'text-white'}`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>{msg.role === 'user' ? avatarData.name : 'PRO COACH AI ✨'}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className="text-sm md:text-base whitespace-pre-wrap"&gt;{msg.text}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{isVoiceActive &amp;&amp; msg.role === 'user' &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="text-xs text-right mt-1 opacity-50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>(Transcripción simulada)</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className={`flex flex-col h-screen pt-16 bg-black text-[${LEAD_WHITE}] p-4 md:p-8 rounded-lg shadow-2xl`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;header className="flex flex-col md:flex-row justify-between items-center pb-4 border-b border-gray-800"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h3 className="text-xl font-bold flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Cpu size={20} className={`mr-2 text-[${LEAD_ORANGE}]`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Entrenando a &lt;span className={`text-[${LEAD_ORANGE}] ml-1`}&gt;{avatarData.name}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className="text-sm text-gray-500 mt-2 md:mt-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>**Coach Prompt:** "Cliente IA: {avatarData.businessType}" | Objeciones: {avatarData.frequentObjections.join(', ')}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Área de Chat */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="flex-grow overflow-y-auto space-y-4 py-6 custom-scrollbar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{messages.map((msg, index) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;ChatMessage key={index} msg={msg} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>))}</p>
<p class="p1"><span class="Apple-converted-space">        </span>{isBotThinking &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="flex justify-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className={`p-4 rounded-xl bg-[${LEAD_GRAY}] text-gray-200 rounded-tl-none border border-gray-700`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div className="flex items-center space-x-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-3 h-3 bg-[${LEAD_ORANGE}] rounded-full animate-bounce"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-3 h-3 bg-[${LEAD_ORANGE}] rounded-full animate-bounce delay-150"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className="w-3 h-3 bg-[${LEAD_ORANGE}] rounded-full animate-bounce delay-300"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div ref={messagesEndRef} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Mensajes de Error/Info */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>{error &amp;&amp; (</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="p-3 text-sm font-semibold rounded-xl bg-red-900/50 border border-red-700 text-red-300 mb-2 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>{error}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>)}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Área de Input y Controles */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="pt-4 border-t border-gray-800"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;form onSubmit={handleSendMessage} className="flex space-x-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input</p>
<p class="p1"><span class="Apple-converted-space">            </span>type="text"</p>
<p class="p1"><span class="Apple-converted-space">            </span>value={input}</p>
<p class="p1"><span class="Apple-converted-space">            </span>onChange={(e) =&gt; setInput(e.target.value)}</p>
<p class="p1"><span class="Apple-converted-space">            </span>disabled={isBotThinking}</p>
<p class="p1"><span class="Apple-converted-space">            </span>placeholder={isVoiceActive ? 'Hablando... (Escribe "feedback" para terminar)' : 'Tu pitch o respuesta... (Escribe "feedback" para terminar)'}</p>
<p class="p1"><span class="Apple-converted-space">            </span>className={`flex-grow p-3 rounded-xl bg-[${LEAD_GRAY}] border border-gray-700 focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}] disabled:opacity-60`}</p>
<p class="p1"><span class="Apple-converted-space">            </span>required={!isVoiceActive}</p>
<p class="p1"><span class="Apple-converted-space">          </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button</p>
<p class="p1"><span class="Apple-converted-space">            </span>type="button"</p>
<p class="p1"><span class="Apple-converted-space">            </span>onClick={toggleVoice}</p>
<p class="p1"><span class="Apple-converted-space">            </span>disabled={isBotThinking}</p>
<p class="p1"><span class="Apple-converted-space">            </span>className={`p-3 rounded-xl transition-colors ${</p>
<p class="p1"><span class="Apple-converted-space">              </span>isVoiceActive<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>? `bg-red-600 hover:bg-red-700 text-white shadow-xl ring-2 ring-red-400`<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>: `bg-black/50 hover:bg-black/80 text-[${LEAD_ORANGE}] border border-gray-700`</p>
<p class="p1"><span class="Apple-converted-space">            </span>}`}</p>
<p class="p1"><span class="Apple-converted-space">            </span>aria-label="Activar/Desactivar Voz"</p>
<p class="p1"><span class="Apple-converted-space">          </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{isVoiceActive ? &lt;Volume2 size={24} /&gt; : &lt;Mic size={24} /&gt;}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton type="submit" disabled={isBotThinking}&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Send size={20} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/form&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className="text-xs text-gray-500 mt-2 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>**TIP**: Para recibir puntuación y guion mejorado, escribe **"feedback"** en el chat.</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* 4. Feedback Post-Roleplay</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const SummaryScreen = ({ summaryData, onRepeat, onSetup, onHome }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const { score, aciertos, mejoras, guion } = summaryData;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const scoreColor = score &gt;= 8 ? 'text-green-500' : score &gt;= 5 ? 'text-yellow-500' : 'text-red-500';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleCopy = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Usamos document.execCommand('copy') por restricciones de iframe</p>
<p class="p1"><span class="Apple-converted-space">    </span>const el = document.createElement('textarea');</p>
<p class="p1"><span class="Apple-converted-space">    </span>el.value = guion;</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.body.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">    </span>el.select();</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.execCommand('copy');</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.body.removeChild(el);</p>
<p class="p1"><span class="Apple-converted-space">    </span>console.log("Guion copiado al portapapeles.");</p>
<p class="p1"><span class="Apple-converted-space">    </span>// En una app real, mostraríamos un toast de éxito</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleExport = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const data = `Score: ${score}/10\n\nAciertos:\n- ${aciertos.join('\n- ')}\n\nMejoras:\n- ${mejoras.join('\n- ')}\n\nGuion Sugerido:\n${guion}`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const blob = new Blob([data], { type: 'text/plain;charset=utf-8' });</p>
<p class="p1"><span class="Apple-converted-space">    </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const link = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">    </span>link.href = url;</p>
<p class="p1"><span class="Apple-converted-space">    </span>link.download = `LeadToCash_Guion_${new Date().toISOString().slice(0, 10)}.txt`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.body.appendChild(link);</p>
<p class="p1"><span class="Apple-converted-space">    </span>link.click();</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.body.removeChild(link);</p>
<p class="p1"><span class="Apple-converted-space">    </span>URL.revokeObjectURL(url);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className={`container mx-auto px-4 py-24 text-[${LEAD_WHITE}] max-w-4xl`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="text-center mb-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;Award size={64} className={`mx-auto mb-4 ${scoreColor} transform scale-100 hover:scale-105 transition-transform duration-300`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2 className="text-4xl font-extrabold mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Feedback Post-Sesión</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className={`text-7xl font-black ${scoreColor} leading-tight`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>{score} / 10</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className="text-xl text-gray-400 mt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>**Menos historia, más cierres.** Analiza el feedback y repite.</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{/* Aciertos */}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className={`p-6 rounded-2xl bg-black border border-green-700 shadow-xl`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h3 className="text-2xl font-bold mb-4 flex items-center text-green-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;CheckCircle size={24} className="mr-2" /&gt; Aciertos</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;ul className="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{aciertos.map((item, index) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;li key={index} className="flex items-start text-gray-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span className="text-green-500 mr-2 flex-shrink-0"&gt;•&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{item}</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>))}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>{/* Mejoras */}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className={`p-6 rounded-2xl bg-black border border-red-700 shadow-xl`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h3 className="text-2xl font-bold mb-4 flex items-center text-red-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;XCircle size={24} className="mr-2" /&gt; Mejoras</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;ul className="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{mejoras.map((item, index) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;li key={index} className="flex items-start text-gray-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span className="text-red-500 mr-2 flex-shrink-0"&gt;•&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>{item}</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/li&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>))}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Guion Sugerido */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className={`p-6 rounded-2xl bg-[${LEAD_GRAY}] border-2 border-[${LEAD_ORANGE}] mb-10`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h3 className="text-2xl font-bold mb-4 flex items-center text-[${LEAD_ORANGE}]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Maximize size={24} className="mr-2" /&gt; Guion Sugerido</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p className="italic text-lg text-gray-300 mb-4 whitespace-pre-wrap"&gt;{guion}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="flex flex-wrap justify-end gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;SecondaryButton onClick={handleCopy} className="text-sm border-gray-600 hover:text-white"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Copy size={16} className="mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Copiar Guion</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton onClick={handleExport} className="text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Exportar Guion (TXT)</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Botones de Acción */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="flex flex-wrap justify-center gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;PrimaryButton onClick={onRepeat}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;RotateCcw size={16} className="mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Repetir Objeción</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;SecondaryButton onClick={onSetup} className="border-gray-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;Users size={16} className="mr-2" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Cambiar Avatar/Industria</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;SecondaryButton onClick={onHome} className="border-gray-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Volver al Inicio</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// --- SECCIONES DE LA LANDING PAGE (Marketing) ---</p>
<p class="p2"><br></p>
<p class="p1">const HeroSection = ({ onOpenModal, isProUser, setView }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;header className={`min-h-screen flex items-center bg-black text-[${LEAD_WHITE}] relative overflow-hidden`} id="hero"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className="absolute inset-0 opacity-10 bg-gradient-to-br from-gray-900 to-gray-800 animate-pulse-slow"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className={`absolute top-1/4 left-1/4 w-3/4 h-3/4 border-l-4 border-t-4 border-[${LEAD_ORANGE}] opacity-20 transform rotate-12`}&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className="container mx-auto px-4 py-24 relative z-10 text-center pt-32"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p className={`text-xl font-medium mb-4 text-[${LEAD_ORANGE}]`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Sell hard. Close fast. Cash in.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h1 className="text-5xl sm:text-7xl md:text-8xl lg:text-9xl font-extrabold mb-8 leading-tight tracking-tighter"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Entrena tus &lt;span className={`text-[${LEAD_ORANGE}]`}&gt;cierres&lt;/span&gt; con IA.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/h1&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p className="max-w-3xl mx-auto text-lg sm:text-xl md:text-2xl font-light mb-12 text-gray-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Practica objeciones reales, entrena con un cliente simulado y convierte tus leads en **cash**.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{isProUser ? (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton onClick={() =&gt; setView(VIEWS.PRO_SETUP)}&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Ir a mi Coach PRO</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>) : (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton onClick={onOpenModal}&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Empieza Gratis (3 roleplays)</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;SecondaryButton href="https://buy.stripe.com/..." className={isProUser ? 'hidden' : 'border-gray-700'}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Entrenar en serio (€49/mes)</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/SecondaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/header&gt;</p>
<p class="p1">);</p>
<p class="p2"><br></p>
<p class="p1">const StorySection = () =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;section className={`py-24 bg-black text-[${LEAD_WHITE}]`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="container mx-auto px-4 max-w-6xl flex flex-col md:flex-row items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="md:w-1/2 mb-10 md:mb-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h2 className="text-3xl sm:text-4xl md:text-5xl font-extrabold mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>La Historia, Simplificada.</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="text-lg md:text-xl font-light text-gray-300 border-l-4 border-[${LEAD_ORANGE}] pl-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>“En 2023, Ricardo estaba en **-313€**. En Miami aprendió a cerrar **$150,000 en dos días**. Hoy ese mismo proceso está en un entrenador que cabe en tu móvil.”</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="mt-6 text-2xl font-semibold"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>**Sin cierres no hay empresa.**</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="md:w-1/2 p-4 flex justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className={`w-full max-w-sm h-64 bg-[${LEAD_ORANGE}]/20 rounded-2xl flex items-center justify-center border-4 border-[${LEAD_ORANGE}]`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;Zap size={64} className={`text-[${LEAD_ORANGE}]`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1">const HowItWorksSection = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const steps = [</p>
<p class="p1"><span class="Apple-converted-space">      </span>{ icon: Award, title: "Elige tu escenario", description: "Configura la industria, el ticket promedio y el perfil de tu cliente ideal." },</p>
<p class="p1"><span class="Apple-converted-space">      </span>{ icon: Cpu, title: "Roleplay real con objeciones", description: "Enfréntate al simulador de cliente. Te pondrá a prueba con objeciones inesperadas y resistencia real." },</p>
<p class="p1"><span class="Apple-converted-space">      </span>{ icon: DollarSign, title: "Feedback instantáneo + guion", description: "Recibe un análisis detallado de tu pitch. ¿Qué funcionó? ¿Dónde te equivocaste? Obtén el guion de cierre sugerido." },</p>
<p class="p1"><span class="Apple-converted-space">      </span>{ icon: TrendingUp, title: "Mide tu progreso", description: "Registra tu Tasa de Cierre (TC), el tiempo de manejo de objeciones y tu mejora diaria. Pasa de Novato a Cerrador." },</p>
<p class="p1"><span class="Apple-converted-space">    </span>];</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>return (</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;section className={`py-24 bg-[${LEAD_GRAY}] text-[${LEAD_WHITE}]`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="container mx-auto px-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h2 className="text-4xl sm:text-5xl font-extrabold mb-16 text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Tu Proceso de Cierre en &lt;span className={`text-[${LEAD_ORANGE}]`}&gt;4 Pasos.&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/h2&gt;</p>
<p class="p2"><span class="Apple-converted-space">          </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div className="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{steps.map((step, index) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;div key={index} className={`flex p-6 rounded-2xl border-2 border-[${LEAD_ORANGE}]/50 bg-black/50 hover:bg-black transition-all duration-300`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div className={`mr-6 text-[${LEAD_ORANGE}]`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>{React.createElement(step.icon, { size: 40 })}</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;p className="text-sm font-semibold mb-2 text-gray-300 uppercase"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Paso {index + 1}</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;h3 className="text-2xl font-bold mb-3"&gt;{step.title}&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;p className="font-light text-gray-400"&gt;{step.description}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>))}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1">const FinalCTASection = ({ onOpenModal, isProUser, setView }) =&gt; (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;section className={`py-24 bg-black text-[${LEAD_WHITE}] text-center`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="container mx-auto px-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2 className="text-4xl sm:text-6xl md:text-7xl font-extrabold mb-10 leading-snug"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Tu equipo no necesita más leads. &lt;span className={`text-[${LEAD_ORANGE}]`}&gt;Necesita cerrar.&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>{isProUser ? (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton onClick={() =&gt; setView(VIEWS.PRO_SETUP)}&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>Ir a mi Coach PRO →</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>) : (</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;PrimaryButton onClick={onOpenModal}&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>Empieza Gratis →</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>)}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p2"><br></p>
<p class="p1">const FreeTrialModal = ({ isOpen, onClose }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const [name, setName] = useState('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const [email, setEmail] = useState('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const [businessType, setBusinessType] = useState('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const [isSubmitted, setIsSubmitted] = useState(false);</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Función para simular el envío del formulario</p>
<p class="p1"><span class="Apple-converted-space">    </span>const submitForm = useCallback(async (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>e.preventDefault();</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!name || !email || !businessType) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.error('ERROR: Por favor, rellena todos los campos.');</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>console.log('Form Submitted (Simulated):', { name, email, businessType });</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Simulación de tiempo de envío</p>
<p class="p1"><span class="Apple-converted-space">      </span>await new Promise(resolve =&gt; setTimeout(resolve, 500));<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>setIsSubmitted(true);</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}, [name, email, businessType]);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isOpen) return null;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>return (</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4 transition-opacity duration-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className={`w-full max-w-lg bg-[${LEAD_GRAY}] text-[${LEAD_WHITE}] p-8 rounded-2xl shadow-2xl relative transform transition-all duration-500 scale-100`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>onClick={onClose}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>className={`absolute top-4 right-4 text-gray-400 hover:text-[${LEAD_ORANGE}] transition`}</p>
<p class="p1"><span class="Apple-converted-space">            </span>aria-label="Cerrar modal"</p>
<p class="p1"><span class="Apple-converted-space">          </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"&gt;&lt;path d="M18 6 6 18"/&gt;&lt;path d="m6 6 12 12"/&gt;&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/button&gt;</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>{!isSubmitted ? (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;h3 className="text-3xl font-extrabold mb-4"&gt;Empieza a Cerrar Gratis&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;p className="mb-6 text-gray-400"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>3 roleplays, sin tarjeta. Solo necesitamos tus datos para abrir tu cuenta de entrenamiento.</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">              </span></p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;form onSubmit={submitForm} className="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;label htmlFor="name" className="block text-sm font-medium mb-1"&gt;Nombre&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>type="text"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>id="name"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>value={name}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>onChange={(e) =&gt; setName(e.target.value)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>className={`w-full p-3 rounded-xl bg-black border border-[${LEAD_GRAY}] focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}]`}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>placeholder="Tu Nombre"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>required</p>
<p class="p1"><span class="Apple-converted-space">                  </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;label htmlFor="email" className="block text-sm font-medium mb-1"&gt;Email&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;input<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>type="email"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>id="email"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>value={email}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>onChange={(e) =&gt; setEmail(e.target.value)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>className={`w-full p-3 rounded-xl bg-black border border-[${LEAD_GRAY}] focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}]`}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>placeholder="tu@negocio.com"</p>
<p class="p1"><span class="Apple-converted-space">                    </span>required</p>
<p class="p1"><span class="Apple-converted-space">                  </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;label htmlFor="businessType" className="block text-sm font-medium mb-1"&gt;Tipo de Negocio&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;select<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>id="businessType"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>value={businessType}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>onChange={(e) =&gt; setBusinessType(e.target.value)}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>className={`w-full p-3 rounded-xl bg-black border border-[${LEAD_GRAY}] focus:border-[${LEAD_ORANGE}] text-[${LEAD_WHITE}]`}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>required</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="" disabled&gt;Selecciona una opción&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="saas"&gt;SaaS&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="consultoria"&gt;Consultoría&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="inmobiliaria"&gt;Inmobiliaria&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;option value="otro"&gt;Otro&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;PrimaryButton type="submit" className="w-full mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                  </span>Activar Mis 3 Roleplays Gratuitos</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/form&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>) : (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className="text-center py-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;Zap size={64} className={`mx-auto mb-4 text-[${LEAD_ORANGE}]`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;h3 className="text-3xl font-extrabold mb-4"&gt;¡Éxito! Estás dentro.&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;p className="mb-6 text-gray-400"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Hemos activado tus 3 roleplays. Prepárate, el bot no perdona.</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;PrimaryButton onClick={onClose}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Volver al Inicio</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>)}</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">/**</p>
<p class="p1"><span class="Apple-converted-space"> </span>* Componente Principal de la Aplicación</p>
<p class="p1"><span class="Apple-converted-space"> </span>*/</p>
<p class="p1">const App = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [currentView, setView] = useState(VIEWS.LANDING);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isModalOpen, setIsModalOpen] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isAuthReady, setIsAuthReady] = useState(false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [userId, setUserId] = useState(null);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [dbInstance, setDbInstance] = useState(null);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// SIMULACIÓN: Control de acceso PRO. TRUE para probar el flujo PRO.</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [isProUser, setIsProUser] = useState(true);<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>const [avatarData, setAvatarData] = useState(null);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const [sessionSummary, setSessionSummary] = useState(null);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const openModal = useCallback(() =&gt; setIsModalOpen(true), []);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const closeModal = useCallback(() =&gt; setIsModalOpen(false), []);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleAvatarSet = useCallback((data) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setAvatarData(data);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setView(VIEWS.PRO_TRAIN);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, []);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const handleSessionEnd = useCallback((summary) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setSessionSummary(summary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>setView(VIEWS.PRO_SUMMARY);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, []);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// --- LÓGICA DE FIREBASE Y AUTH ---</p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Inicializar Firebase</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (Object.keys(firebaseConfig).length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.error("Firebase no inicializado: falta __firebase_config. Usando modo de simulación.");</p>
<p class="p1"><span class="Apple-converted-space">      </span>setIsAuthReady(true);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">        </span>app = initializeApp(firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">        </span>auth = getAuth(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>db = getFirestore(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>setDbInstance(db); // Almacenar instancia de DB</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.error("Error al inicializar Firebase:", e);</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Si hay error, salimos del useEffect para evitar un bucle de errores</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const unsubscribe = onAuthStateChanged(auth, async (user) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (user) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setUserId(user.uid);</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (initialAuthToken) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const credential = await signInWithCustomToken(auth, initialAuthToken);</p>
<p class="p1"><span class="Apple-converted-space">            </span>setUserId(credential.user.uid);</p>
<p class="p1"><span class="Apple-converted-space">          </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const credential = await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">            </span>setUserId(credential.user.uid);</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>console.error("Error signing in:", error);</p>
<p class="p1"><span class="Apple-converted-space">          </span>// Si el inicio de sesión falla, aún permitimos la inicialización</p>
<p class="p1"><span class="Apple-converted-space">          </span>setUserId(null);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>setIsAuthReady(true);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>return () =&gt; unsubscribe();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, []);</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Lógica para cargar el estado PRO y el avatar</p>
<p class="p1"><span class="Apple-converted-space">  </span>useEffect(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Si la autenticación no está lista o no tenemos ID de usuario, no hacemos nada</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isAuthReady || !dbInstance || !userId) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isProUser) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const loadAvatar = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">          </span>// Obtener avatar del path privado</p>
<p class="p1"><span class="Apple-converted-space">          </span>const avatarRef = doc(dbInstance, `artifacts/${appId}/users/${userId}/avatars/${userId}`);</p>
<p class="p1"><span class="Apple-converted-space">          </span>const docSnap = await getDoc(avatarRef);</p>
<p class="p2"><span class="Apple-converted-space">          </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>if (docSnap.exists()) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setAvatarData(docSnap.data());</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Si tiene avatar y está en landing, lo llevamos a entrenar</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (currentView === VIEWS.LANDING) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>setView(VIEWS.PRO_TRAIN);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">          </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Si es PRO pero no tiene avatar, lo llevamos al setup</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (currentView === VIEWS.LANDING || currentView === VIEWS.PRO_TRAIN) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>setView(VIEWS.PRO_SETUP);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>console.error("Error loading avatar:", error);</p>
<p class="p1"><span class="Apple-converted-space">          </span>// En caso de error, siempre lo mandamos a configurar</p>
<p class="p1"><span class="Apple-converted-space">          </span>setView(VIEWS.PRO_SETUP);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">      </span>loadAvatar();</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Si el usuario no es PRO y está intentando acceder a una vista PRO</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (currentView !== VIEWS.LANDING) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setView(VIEWS.PRO_GATE);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}, [isAuthReady, userId, isProUser, dbInstance, currentView]);</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// --- LÓGICA DE ENRUTAMIENTO Y VISTAS PRINCIPALES ---</p>
<p class="p1"><span class="Apple-converted-space">  </span>const renderContent = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Si la autenticación aún no está lista, mostrar carga</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!isAuthReady) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>return (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className={`min-h-screen flex items-center justify-center text-[${LEAD_WHITE}] bg-black`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;Zap size={32} className={`text-[${LEAD_ORANGE}] animate-spin mr-3`} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-xl"&gt;Cargando Coach PRO...&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Si está listo pero no tiene DB/User (ej. fallo de auth), mostramos un error genérico</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!dbInstance || !userId) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>return (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div className={`min-h-screen flex flex-col items-center justify-center text-[${LEAD_WHITE}] bg-black pt-20 p-4`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;Lock size={64} className="text-red-500 mb-4" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h2 className="text-3xl font-bold mb-4"&gt;Error de Conexión&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p className="text-gray-400 text-center max-w-md"&gt;No se pudo establecer la conexión con la base de datos o autenticar al usuario. Por favor, asegúrate de que la configuración de Firebase sea válida.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;PrimaryButton onClick={() =&gt; window.location.reload()} className="mt-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Recargar Aplicación</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/PrimaryButton&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>switch (currentView) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>case VIEWS.PRO_GATE:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return &lt;ProAccessGate onUpgradeClick={() =&gt; setView(VIEWS.LANDING)} /&gt;;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>case VIEWS.PRO_SETUP:</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!isProUser) return &lt;ProAccessGate onUpgradeClick={() =&gt; setView(VIEWS.LANDING)} /&gt;;</p>
<p class="p1"><span class="Apple-converted-space">        </span>return &lt;AvatarSetupForm userId={userId} db={dbInstance} onAvatarSet={handleAvatarSet} defaultData={avatarData} /&gt;;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>case VIEWS.PRO_TRAIN:</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!isProUser) return &lt;ProAccessGate onUpgradeClick={() =&gt; setView(VIEWS.LANDING)} /&gt;;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Si no hay avatar, lo mandamos a setup</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!avatarData) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setView(VIEWS.PRO_SETUP);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return null; // Renderizará la vista de setup en el siguiente ciclo</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>return &lt;TrainingSession userId={userId} db={dbInstance} avatarData={avatarData} onSessionEnd={handleSessionEnd} /&gt;;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>case VIEWS.PRO_SUMMARY:</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!isProUser) return &lt;ProAccessGate onUpgradeClick={() =&gt; setView(VIEWS.LANDING)} /&gt;;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!sessionSummary) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>setView(VIEWS.PRO_TRAIN);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>return (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;SummaryScreen<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>summaryData={sessionSummary}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>onRepeat={() =&gt; setView(VIEWS.PRO_TRAIN)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>onSetup={() =&gt; setView(VIEWS.PRO_SETUP)}</p>
<p class="p1"><span class="Apple-converted-space">                </span>onHome={() =&gt; setView(VIEWS.LANDING)}</p>
<p class="p1"><span class="Apple-converted-space">            </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>case VIEWS.LANDING:</p>
<p class="p1"><span class="Apple-converted-space">      </span>default:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return (</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;HeroSection onOpenModal={openModal} isProUser={isProUser} setView={setView} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;StorySection /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;HowItWorksSection /&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;FinalCTASection onOpenModal={openModal} isProUser={isProUser} setView={setView} /&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return (</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div className={`min-h-screen bg-black font-sans`} style={{ color: LEAD_WHITE }}&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Script para configurar colores custom de Tailwind. */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;script</p>
<p class="p1"><span class="Apple-converted-space">        </span>dangerouslySetInnerHTML={{</p>
<p class="p1"><span class="Apple-converted-space">          </span>__html: `</p>
<p class="p1"><span class="Apple-converted-space">            </span>tailwind.config = {</p>
<p class="p1"><span class="Apple-converted-space">              </span>theme: {</p>
<p class="p1"><span class="Apple-converted-space">                </span>extend: {</p>
<p class="p1"><span class="Apple-converted-space">                  </span>colors: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>'lead-orange': '${LEAD_ORANGE}',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>'lead-gray': '${LEAD_GRAY}',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>'lead-white': '${LEAD_WHITE}',</p>
<p class="p1"><span class="Apple-converted-space">                  </span>},</p>
<p class="p1"><span class="Apple-converted-space">                  </span>fontFamily: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Usando Helvetica Neue como fallback para Object Sans</p>
<p class="p1"><span class="Apple-converted-space">                    </span>sans: ['"Helvetica Neue"', 'Helvetica', 'Arial', 'sans-serif'],</p>
<p class="p1"><span class="Apple-converted-space">                  </span>},</p>
<p class="p1"><span class="Apple-converted-space">                  </span>animation: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',</p>
<p class="p1"><span class="Apple-converted-space">                  </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">              </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">          </span>`</p>
<p class="p1"><span class="Apple-converted-space">        </span>}}</p>
<p class="p1"><span class="Apple-converted-space">      </span>/&gt;</p>
<p class="p2"><span class="Apple-converted-space">      </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;NavBar<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>currentView={currentView}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>setView={setView}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>isProUser={isProUser}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>hasAvatar={!!avatarData}</p>
<p class="p1"><span class="Apple-converted-space">      </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>{/* Contenido principal basado en la vista actual */}</p>
<p class="p1"><span class="Apple-converted-space">      </span>{renderContent()}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;footer className={`py-12 bg-[${LEAD_GRAY}] text-center text-gray-400`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div className="container mx-auto px-4 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="mb-4"&gt;&amp;copy; {new Date().getFullYear()} Lead to Cash AI. Sell hard. Close fast. Cash in.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;p className="mb-1 text-xs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>{userId &amp;&amp; `User ID: ${userId}`} |<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>{isProUser ? ' Plan: PRO Activo' : ' Plan: FREE'}</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;a href="#" className={`text-[${LEAD_ORANGE}] hover:text-white font-bold transition-colors`}&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Términos y Condiciones</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/footer&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;FreeTrialModal<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>isOpen={isModalOpen}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>onClose={closeModal}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>);</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">export default App;</p>
</body>
</html>
